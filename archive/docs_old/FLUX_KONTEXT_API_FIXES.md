# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è API FLUX Kontext LoRA

## üìÖ –î–∞—Ç–∞: 8 —è–Ω–≤–∞—Ä—è 2025

## üéØ –ü—Ä–æ–±–ª–µ–º—ã, –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã

### 1. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ API**
**–ü—Ä–æ–±–ª–µ–º–∞**: –ö–æ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª –ø—Ä—è–º—ã–µ HTTP requests –≤–º–µ—Å—Ç–æ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞
```python
# –ë—ã–ª–æ (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ):
response = requests.post("https://fal.run/fal-ai/flux-kontext-lora", ...)

# –°—Ç–∞–ª–æ (–ø—Ä–∞–≤–∏–ª—å–Ω–æ):
result = fal_client.subscribe("fal-ai/flux-kontext-lora", ...)
```

### 2. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—á–µ—Ä–µ–¥–∏**
**–ü—Ä–æ–±–ª–µ–º–∞**: API –º–æ–∂–µ—Ç –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å —Å—Ç–∞—Ç—É—Å—ã –æ—á–µ—Ä–µ–¥–∏, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª–∏—Å—å
**–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–ª–µ–Ω `on_queue_update` callback –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞

### 3. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**
**–ü—Ä–æ–±–ª–µ–º–∞**: `fal-client` –Ω–µ –±—ã–ª –≤ requirements.txt
**–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å `fal-client==0.3.0`

## ‚úÖ –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### üìÅ –§–∞–π–ª: `requirements.txt`
- ‚ûï –î–æ–±–∞–≤–ª–µ–Ω `fal-client==0.3.0`

### üìÅ –§–∞–π–ª: `app_api.py`
- üîÑ –§—É–Ω–∫—Ü–∏—è `remove_background_fal()` –ø–µ—Ä–µ–ø–∏—Å–∞–Ω–∞ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `fal_client`
- ‚ûï –î–æ–±–∞–≤–ª–µ–Ω—ã callbacks –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞  
- ‚ûï –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏
- ‚ûï –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π fallback –Ω–∞ BiRefNet —á–µ—Ä–µ–∑ fal_client

### üìÅ –§–∞–π–ª: `src/processors/batch_processor.py`
- üîÑ –ú–µ—Ç–æ–¥ `_remove_background_fal_v2()` –ø–µ—Ä–µ–ø–∏—Å–∞–Ω –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `fal_client`
- üîÑ –ú–µ—Ç–æ–¥ `_remove_background_fal()` –ø–µ—Ä–µ–ø–∏—Å–∞–Ω –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `fal_client`
- ‚ûï –î–æ–±–∞–≤–ª–µ–Ω—ã callbacks –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
- ‚ûï –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –¥–ª—è LoRA V1 –∏ V2
- ‚ûï –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π fallback –Ω–∞ BiRefNet —á–µ—Ä–µ–∑ fal_client

## üîç –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

### 1. **–ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –∫–ª–∏–µ–Ω—Ç**
```python
import fal_client

# –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å –ø–æ–¥–ø–∏—Å–∫–æ–π
result = fal_client.subscribe(
    "fal-ai/flux-kontext-lora",
    arguments={
        "image_url": f"data:image/png;base64,{img_base64}",
        "prompt": prompt,
        "num_inference_steps": 30,
        "guidance_scale": 2.5,
        "output_format": "png",
        "enable_safety_checker": False,
        "loras": [{"path": lora_path, "scale": 1.0}],
        "resolution_mode": "match_input"
    },
    with_logs=True,
    on_queue_update=on_queue_update,
)
```

### 2. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞**
```python
def on_queue_update(update):
    if isinstance(update, fal_client.InProgress):
        print(f"üîÑ Processing: {len(update.logs)} logs")
        for log in update.logs[-2:]:  # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ 2 –ª–æ–≥–∞
            print(f"  {log.get('message', '')}")
```

### 3. **–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Å—Ö–µ–º–∞ API**
–í—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ç–µ–ø–µ—Ä—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:
- `image_url` (string) - URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–ª–∏ data URI
- `prompt` (string) - –ü—Ä–æ–º–ø—Ç –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è  
- `num_inference_steps` (integer) - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —à–∞–≥–æ–≤ inference
- `guidance_scale` (float) - CFG scale
- `output_format` (string) - –§–æ—Ä–º–∞—Ç –≤—ã–≤–æ–¥–∞ (png/jpeg)
- `enable_safety_checker` (boolean) - –í–∫–ª—é—á–∏—Ç—å safety checker
- `loras` (array) - –ú–∞—Å—Å–∏–≤ LoRA –º–æ–¥–µ–ª–µ–π —Å path –∏ scale
- `resolution_mode` (string) - –†–µ–∂–∏–º —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è (match_input/auto/...)

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

‚úÖ **–í—Å–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã** —Å —Ä–µ–∞–ª—å–Ω—ã–º API:
- ‚úÖ –ò–º–ø–æ—Ä—Ç fal_client
- ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è API –∫–ª—é—á–∞
- ‚úÖ –°—Ö–µ–º–∞ FLUX Kontext API
- ‚úÖ –†–µ–∞–ª—å–Ω—ã–π API –≤—ã–∑–æ–≤ —Å BiRefNet

## üöÄ –†–µ–∑—É–ª—å—Ç–∞—Ç

**–î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π**: 
- ‚ùå API –≤—ã–∑–æ–≤—ã –º–æ–≥–ª–∏ –∑–∞–≤–∏—Å–∞—Ç—å –∏–ª–∏ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –æ—à–∏–±–∫–∏
- ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤  
- ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø—Ä–æ–≥—Ä–µ—Å—Å–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏

**–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π**:
- ‚úÖ –°—Ç–∞–±–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–º –∫–ª–∏–µ–Ω—Ç–æ–º
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—á–µ—Ä–µ–¥–∏ –∏ —Å—Ç–∞—Ç—É—Å–æ–≤
- ‚úÖ –ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ –ø—Ä–æ–≥—Ä–µ—Å—Å–µ
- ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π fallback –Ω–∞ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã
- ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ API

## üìù –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è**: –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `FAL_KEY` –∏–ª–∏ `FAL_API_KEY` –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
2. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π**: –ó–∞–ø—É—Å—Ç–∏—Ç–µ `pip install -r requirements.txt` 
3. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**: –õ–æ–≥–∏ —Ç–µ–ø–µ—Ä—å –±–æ–ª–µ–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ —Å —ç–º–æ–¥–∑–∏ –∏ —Å—Ç–∞—Ç—É—Å–∞–º–∏
4. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: API —Ç–µ–ø–µ—Ä—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –¥–ª–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏

---

**–ê–≤—Ç–æ—Ä**: AI Assistant (Claude)  
**–î–∞—Ç–∞**: 8 —è–Ω–≤–∞—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ